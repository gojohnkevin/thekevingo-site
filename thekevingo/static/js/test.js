"undefined"==typeof window.fbAppHelper?window.fbAppHelper={status:null,platform:"external",authResponse:{accessToken:null,expiresIn:null,signedRequest:null,userID:null},data:{user:{},page:{},app:{}},init:function(){},invoke:function(a,b){"function"==typeof a&&a(b)},isConnected:function(){return this.authResponse.accessToken&&"connected"===this.status},authorize:function(a,b,c){var d=this;d.isConnected()?d.invoke(a):FB.login(function(c){d.status=c.status;var e=a;c.authResponse?(d.authResponse.accessToken=c.authResponse.accessToken,d.authResponse.expiresIn=c.authResponse.expiresIn,d.authResponse.signedRequest=c.authResponse.signedRequest,d.authResponse.userID=c.authResponse.userID):e=b,d.invoke(e,c)},{scope:c})},hasPermission:function(a,b,c){var d=this,e=!1;FB.api("/me/permissions",function(f){if(f&&!f.error)for(i in f.data)if(f.data[i].permission==a){"granted"==f.data[i].status&&(e=!0);break}e===!0?d.invoke(b):d.invoke(c)})},onSubscribe:function(a,b){},getUser:function(a,b,c){var d=this,e=["id","name","first_name","middle_name","last_name","gender"];c="undefined"!=typeof c?c:[];var f=$.merge(e,c),g=function(){var b="/me/?fields="+f.join()+"&access_token="+d.authResponse.accessToken;FB.api(b,function(b){d.invoke(a,b)})};this.isConnected()?g():FB.login(function(a){a.authResponse?g():d.invoke(b)})},feed:function(a,b,c,d){var e=this;console.log(d);var f={method:"feed",link:a};if(void 0!==d)if(null!==d)var g=$.extend({},f,d);else var g=f;console.log(g),FB.ui(g,function(a){a&&!a.error_code?e.invoke(b,a):e.invoke(c,a)})},share:function(a,b,c){var d=this;FB.ui({method:"share",href:a},function(a){a&&!a.error_code?d.invoke(b,a):d.invoke(c,a)})},post:function(a,b){var c=this,d="publish_actions",e=function(){FB.api("/me/feed","post",{message:a},function(a){c.invoke(b,a)})};this.hasPermission(d)?e():FB.login(function(a){a.authResponse&&(c.authResponse.accessToken=a.authResponse.accessToken,c.authResponse.expiresIn=a.authResponse.expiresIn,c.authResponse.signedRequest=a.authResponse.signedRequest,c.authResponse.userID=a.authResponse.userID),c.authResponse.accessToken?c.invoke(successCallback,a):c.invoke(failureCallback,a)},{scope:d})}}:console.log("window.fbAppHelper definition error. Name in global scope is in use."),$(document).ready(function(){function a(){$("[data-scroll-to]").each(function(){var a=$(document).scrollTop(),b=$(this),c=$(b.data("scroll-to"));"#brtwoz"==b.data("scroll-to")?c=$("#brtwo"):"#brthreez"==b.data("scroll-to")?c=$("#brthree"):"#brfivez"==b.data("scroll-to")&&(c=$("#brfive"));var d=c;d.position().top+parseInt(d.css("marginTop"),10)<=a?($("[data-scroll-to]").removeClass("active"),b.addClass("active")):b.removeClass("active")})}a(),$(window).scroll(function(){a()}),$("body").on("click","[data-fb-share]",function(){var a=$(this).data("fb-share");FB.ui({method:"share",href:a,display:"popup"},function(a){})}),$("[data-scroll-to]").on("click",function(){var a=$(this).data("scroll-to"),b=$(a).offset().top;$("html,body").animate({scrollTop:b+30},"slow")}),$(".magnific-gallery").each(function(a,b){for(var c=$(this),d=$(this).data("links").split(","),e=[],f=0;f<d.length;f++)e.push({src:d[f],title:""});c.magnificPopup({mainClass:"mfp-fade",items:e,gallery:{enabled:!0,tPrev:$(this).data("prev-text"),tNext:$(this).data("next-text")},type:"image"})}),$(document).on("click","[data-btn]",function(){function a(a){$("#curatePage .btn").addClass("active"),$("#checkinDate").text("Check in date: "+a)}var b=$(this);switch(b.data("btn")){case"popup-video":var c=$(this).data("video");c&&$.magnificPopup.open({items:{src:c},type:"iframe"});break;case"ajax-checkin":var d=$(this).data("userinfo");$.ajax({url:d,method:"POST",dataType:"json",success:function(b){b.success&&a(b.date)}});break;case"popup-link":var e=$(this).data("link");e&&(window.location.href=$(this).data("link"))}}),$("[breitling-subscribe]").on("click",function(a){var b=[],c={onElementValidate:function(a,c,d,e){a||b.push({el:c,error:e})}},d={};$.formUtils.loadModules("security, date"),b=[],$("[breitling-subscribe-form]").isValid(d,c,!0)&&(data={email:$("#subscribeEmail").val()},$.ajax({method:"POST",dataType:"json",url:$("[breitling-subscribe-form]").data("url"),data:data}).done(function(a){return a.success?(alert("Thanks for subscribing !"),void $("#subscribeEmail").val("")):void alert(a.message)}))})}),$(function(){function a(a){var b={};return a&&"[object Function]"===b.toString.call(a)}function b(a){return void 0!==a?1e3*a:0}function c(b,c,d,e){b&&$.ajax({method:"POST",dataType:"json",url:b,data:c}).done(function(b){b.success?a(d)&&d(b):a(e)&&e(b)})}function d(a){var b=[],c={onElementValidate:function(a,c,d,e){a||b.push({el:c,error:e})}},d={};$.formUtils.loadModules("security, date"),a(b,c,d)}function e(a){return k&&(a/=2),a}function f(a){var b=a.originalEvent.touches?a.originalEvent.touches[0].pageY:a.pageY;b>j&&(n.action.scrolled=!0),j=b}function g(){var a=m.gameSettings.maximumTime-(n.storage.time+=n.eventTimer.timeSpent[0]),b=(Math.floor(a/3600),a%3600),c=Math.floor(b/60),d=b%60,e=Math.ceil(d),f={m:c,s:e};return 0===f.m?f.s+" sec":f.m+" min "+f.s+" sec"}function h(a){return"/"===a.substr(-1)?a.substr(0,a.length-1):a}Array.prototype.last=function(){return this[this.length-1]},$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}}),$.preloadImages=function(){for(var a=0;a<arguments.length;a++){var b=$("<img />").attr("src",arguments[a]);b.bind("load",function(){}),b[0].width&&b.trigger("load")}};var i,j,k=([].slice,/iphone|ipad|ipod|android|blackberry|mini|windows\sce|palm/i.test(navigator.userAgent.toLowerCase()));i=function(){return i.prototype.init()};var l=[["brI01",e(1920),e(1080),e(0),e(1080),!1,0,[],e(1080)],["brI02",e(1920),e(6e3),e(1080),e(7080),!1,0,[],e(6e3)],["brI03",e(1920),e(6e3),e(7080),e(13080),!1,0,[],e(6e3)],["brI04",e(1920),e(6e3),e(13080),e(19080),!1,0,[],e(6e3)],["brI05",e(1920),e(6e3),e(19080),e(25080),!1,0,[],e(6e3)],["brI06",e(1920),e(5760),e(25080),e(146040),!0,0,[],e(6e3)],["brI07",e(1920),e(6e3),e(146040),e(152040),!1,0,[],e(6e3)],["brI08",e(1920),e(6e3),e(152040),e(158040),!1,0,[],e(6e3)],["brI09",e(1920),e(6e3),e(158040),e(164040),!1,0,[],e(6e3)],["brI10",e(1920),e(6e3),e(164040),e(170040),!1,0,[],e(6e3)],["brI11",e(1920),e(6e3),e(170040),e(176040),!1,0,[],e(6e3)],["brI12",e(1920),e(6e3),e(176040),e(182040),!1,0,[],e(6e3)],["brI13",e(1920),e(6e3),e(182040),e(188040),!1,0,[],e(6e3)],["brI14",e(1920),e(6e3),e(188040),e(194040),!1,0,[],e(6e3)]],m={path:{website:h($("body").data("root")),image:"/images",thumb:"/thumb"},eventTarget:{scrollCoverArea:"body",gameStart:"[breitling-start]",gameRestart:"[breitling-restart]",gameLogout:"[breitling-logout]",gameContainer:"[breitling-container]",gameFeedback:"[breitling-feedback]",score:{button:"[breitling-scoreboard]",container:"[breitling-scoreboard-container]",close:"[breitling-scoreboard-close]"},loading:{container:!1,fieldFeedback:!1},qr:{container:"[breitling-qr-container]"},finish:{container:"[breitling-finish]"},account:{container:"[breitling-acc-container]",open:"[breitling-acc-open]",close:"[breitling-acc-close]"},viewProfile:{container:!1,open:!1,close:!1},login:{container:!1,buttonSubmit:!1,status:!1,form:!1,close:"[breitling-login-close]",open:"[breitling-login-open]"},register:{container:!1,buttonSubmit:!1,status:!1,form:!1,close:"[breitling-register-close]",open:"[breitling-register-open]"},splash:{container:!1},overlay:{container:!1},socialRegisterLogin:{container:!1,buttonSubmit:!1,buttonLogin:!1,authenticate:!1,status:!1,form:!1,close:"[breitling-social-close]"}},urls:{website:h($("body").data("root")),userLogin:"/participant/login",userRegister:"/participant/register",userSocialRegisterLogin:"/participant/social_authenticate",userQRCode:"/participant/qr",roomCreate:"/participant/createPlay",roomUpdate:"/participant/updatePlay",scoreboard:"/play/leaderboard",account:"/play/profile"},loading:{totalImage:0,totalLoadedImage:0},gameTexture:{size:l.length,firstImage:{height:l[0][2]},maximumStacked:e(12),tolerance:{min:4}},gameSettings:{ppm:e(4e3),highestPixels:l.last()[4],speed:{stepUp:10,stepDown:.5,maximum:e(100)},screen:{width:e(1920)},fpms:25,textureRedrawms:250,nextFramePixels:250,maximumTime:45,peak:function(){return this.highestPixels/this.ppm}(),qrCode:1,pearkMaxToEnableSave:0}},n={eventTimer:{timeSpent:[.25,!1],speedAverage:[.25,!1],peak:[.25,!1],pauseTimer:[2.5,!1],qrCodeChecker:[.25,!1]},storage:{time:0,timeField:null,speed:0,speedField:0,height:0,heightPrevious:0,peak:0,peakField:0,screen:{height:0,left:0,paddingLeft:0},stopScene:!1,centerMain:!1,currentScene:null,finishGame:!1,giveUpGame:!1,lastScene:!1},eventTarget:{screen:!1,fieldPeak:!1,fieldAvgSpeed:!1,fieldTimeSpent:!1,fieldSaveGame:!1,sidebar:!1},action:{scrolled:!1,paused:!1,started:!1,waitingForScrollToStart:!1}},o={personal:{},game_id:!1,unique_id:!1,update:{qr:!1}};i.prototype.layoutWindowResize=function(){var a=this;return $(window).bind("resize",function(){n.storage.screen.height=$(m.eventTarget.scrollCoverArea).height(),$("body").width()<m.gameSettings.screen.width?(n.storage.screen.left=($("body").width()-m.gameSettings.screen.width)/2,n.storage.screen.paddingLeft=0):(n.storage.screen.left=0,$("body").width()>m.gameSettings.screen.width?n.storage.screen.paddingLeft=($("body").width()-m.gameSettings.screen.width)/2:n.storage.screen.paddingLeft=0),n.storage.centerMain=!1}).resize(),$(window).resize(),a},i.prototype.layoutCreateInterface=function(){var a=this;return $('<div id="mainScreen" class="scrollable"></div>').appendTo(m.eventTarget.gameContainer),$('<div id="sideBar"><div class="wrap"><div class="height"><span style="margin-bottom:0px">Altitude (Metre): </span><b>20.2</b></div><div class="avarageSpeed"><span>Current speed: <b>20cm/s</b></span></div><div class="timeSpent"><span>Time left: <b>0 h 1 min 30 sec</b></span></div><a href="javascript:;" class="btn btn-save-records active">RESTART</a></div></div>').appendTo(m.eventTarget.gameFeedback),n.eventTarget.screen=$("#mainScreen"),n.eventTarget.fieldPeak=$(".height b"),n.eventTarget.fieldAvgSpeed=$(".avarageSpeed b"),n.eventTarget.fieldTimeSpent=$(".timeSpent b"),n.eventTarget.fieldSaveGame=$(".btn-save-records"),n.eventTarget.sidebar=$("#sideBar"),m.eventTarget.loading.container=$("#notification #loading"),m.eventTarget.loading.fieldFeedback=$("#notification #loading .target"),m.eventTarget.login.container=$("#notification #login"),m.eventTarget.login.buttonSubmit=$("#notification #login .submit"),m.eventTarget.login.form=$("#notification #login form"),m.eventTarget.splash.container=$("#notification #splash"),m.eventTarget.overlay.container=$("#notification #overlay"),m.eventTarget.register.container=$("#notification #register"),m.eventTarget.register.buttonSubmit=$("#notification #register .submit"),m.eventTarget.register.form=$("#notification #register form"),m.eventTarget.socialRegisterLogin.container=$("#notification #confirmFacebook"),m.eventTarget.socialRegisterLogin.buttonSubmit=$("#notification #confirmFacebook .submit"),m.eventTarget.socialRegisterLogin.buttonLogin=$("#notification [data-facebook-login]"),m.eventTarget.socialRegisterLogin.form=$("#notification #confirmFacebook form"),a},i.prototype.layoutMaximumStacked=function(){var a=null,b=n.eventTarget.screen.find("img").length;return a=b>m.gameTexture.maximumStacked-1?!0:n.storage.lastScene?!0:!1},i.prototype.layoutCreateTexture=function(){var a=this,b=0;return a.layoutAutoTexture(b),a},i.prototype.layoutNextTexture=function(a){var b={};return $.each(l,function(c,d){if(a>=d[3]&&a<d[4]){if((d[4]-d[3])/d[8]>1&&d[5]===!0?b.img_id=d[0]+Math.ceil((a-d[3])/d[8]):b.img_id=d[0],b.file_id=d[0],b.width=d[1],b.height=d[2],b.start=d[3],b.format=d[6],(d[4]-d[3])/d[8]>1&&d[5]===!0)var e=Math.ceil((a-d[3])/d[8]);else var e=1;0==parseInt(e)&&(e=1),b.multiply=Math.ceil(e)}}),b};var p=!1,q=0;i.prototype.layoutAutoTexture=function(a){var b=this;if(n.storage.lastScene)return!1;if(!p){for(p=!0,q=0;!b.layoutMaximumStacked();){q=+e(50);var c=a+q;b.layoutAutoTexture(c),p=!1}return b}p=!1;var d=b.layoutNextTexture(a);if($.isEmptyObject(d)===!0)return n.storage.lastScene=!0,!1;var f=d.file_id,g=d.img_id,h=d.format,i=-d.start,j=d.width,k=d.height,l=d.multiply;if(g){var o=m.path.website+m.path.image+"/"+f.split("brI")[1]+"."+(0==h?"jpg":"png"),r=m.path.website+m.path.image+m.path.thumb+"/"+f.split("brI")[1]+"."+(0==h?"jpg":"png"),s="position:absolute;top: "+(i-k*l+m.gameTexture.firstImage.height)+"px; width:"+j+"px;height: "+k+"px; z-index: 0;background: url("+r+")";n.eventTarget.screen.find("#"+g).length>0||$(b.template(g,o,s)).appendTo(n.eventTarget.screen)}return b},i.prototype.layoutQuanlity=function(){var a=this;$("[id]").each(function(){$('[id="'+this.id+'"]:gt(0)').remove()});for(var b=n.eventTarget.screen.find("img"),c=b.length-1;c>=0;c--){var d=Math.abs(parseInt($(b[c]).css("top")));if(n.storage.height-n.storage.screen.height>d){if(n.storage.lastScene)return returnValue=!0,!1;c<m.gameTexture.tolerance.min&&$(b[c-1]).length&&$(b[c-1]).remove()}}return a},i.prototype.eventOnTouch=function(){var a=this;return $(m.eventTarget.scrollCoverArea).bind("touchstart",function(a){!n.action.waitingForScrollToStart&&n.action.started&&0===n.storage.height&&(n.action.waitingForScrollToStart=!0)}),$(m.eventTarget.scrollCoverArea).bind("touchmove",function(a){return f(a),a.preventDefault(),!0}),a},i.prototype.eventOnMouseWheel=function(){var a=this;return $(m.eventTarget.scrollCoverArea).mousewheel(function(a,b){return n.action.paused?!1:void(b>0&&(!n.action.waitingForScrollToStart&&n.action.started&&0===n.storage.height&&(n.action.waitingForScrollToStart=!0),n.action.scrolled=!0))}),a},i.prototype.watchHeight=function(a){if(n.storage.height+a<=0)n.storage.height=0;else{if(n.storage.height+a>=m.gameSettings.highestPixels-n.storage.screen.height)return n.storage.height=m.gameSettings.highestPixels-n.storage.screen.height,n.storage.speed=0,!1;n.storage.height+=a,n.storage.heightPrevious!=n.storage.height&&(clearTimeout(n.eventTimer.pauseTimer[1]),n.eventTimer.pauseTimer[1]=setTimeout(function(){0===n.storage.speed},b(n.eventTimer.pauseTimer[0]))),n.storage.heightPrevious=n.storage.height}},i.prototype.watchSpeed=function(){var a=this;return n.storage.finishGame||n.storage.giveUpGame?!1:(n.action.scrolled?(n.action.scrolled=!1,n.storage.speed<m.gameSettings.speed.maximum?n.storage.speed+=m.gameSettings.speed.stepUp:n.storage.speed=m.gameSettings.speed.maximum-(8*Math.random()+2)):n.storage.speed>0?n.storage.speed-=m.gameSettings.speed.stepDown:n.storage.speed=0,a.watchHeight(n.storage.speed),a)},i.prototype.userAccount=function(){var a=this;return $(m.eventTarget.account.close).on("click",function(a){$(m.eventTarget.account.container).removeClass("active"),$(m.eventTarget.scrollCoverArea).bind("touchmove",function(a){return f(a),a.preventDefault(),!0})}),$(m.eventTarget.account.open).on("click",function(a){var b=m.urls.website+m.urls.account,d={};"undefined"!=typeof o.personal.id&&(d={id:o.personal.id});var e=function(a){$(m.eventTarget.account.container).find(".avatar").css("background-image","url('"+a.owner.avatar_url+"')"),$(m.eventTarget.account.container).find(".email").text(a.owner.email),$(m.eventTarget.account.container).find(".name").text(a.owner.username),a.owner.qr_url.length>0?($(m.eventTarget.account.container).find("img").show(),$(m.eventTarget.account.container).find("img").attr("src",a.owner.qr_url),$(m.eventTarget.account.container).find(".presentqr").show()):($(m.eventTarget.account.container).find("img").hide(),$(m.eventTarget.account.container).find(".presentqr").hide()),$(m.eventTarget.account.container).addClass("active"),$(m.eventTarget.scrollCoverArea).unbind("touchmove")},f=function(a){alert(a.message)};c(b,d,e,f)}),a},i.prototype.userScoreBoard=function(){var a=this;return $(m.eventTarget.score.close).on("click",function(a){$(m.eventTarget.score.container).removeClass("active"),$(m.eventTarget.scrollCoverArea).bind("touchmove",function(a){return f(a),a.preventDefault(),!0})}),$(m.eventTarget.score.button).on("click",function(a){var b=m.urls.website+m.urls.scoreboard,d={};"undefined"!=typeof o.personal.id&&(d={id:o.personal.id});var e=function(a){if(a.players.length>0&&($(".scorelist ul.list").html(""),$.each(a.players,function(a,b){var c="";6>a+1&&(c="top");var d="<li class='"+c+"'>"+(parseInt(a)+1)+"<span class='name'>"+b.username+"</span><span class='distance'>"+b.distance+" M</span></li>";$(".scorelist ul.list").append(d)}),a.owner&&$.isEmptyObject(a.owner)===!1)){$(".scorelist ul.list").append("<li class='separator'>&bull;&bull;&bull;</li>");var b="";a.owner.rank<6&&(b="top");var c="<li class='owner "+b+" '>"+a.owner.rank+"<span class='name'>"+a.owner.username+"</span><span class='distance'>"+a.owner.distance+" M</span></li>";$(".scorelist ul.list").append(c)}$(m.eventTarget.score.container).addClass("active"),$(m.eventTarget.scrollCoverArea).unbind("touchmove")},f=function(a){alert(a.message)};c(b,d,e,f)}),a},i.prototype.userSocialRegisterLogin=function(){var a=this;return $(m.eventTarget.socialRegisterLogin.close).on("click",function(a){m.eventTarget.socialRegisterLogin.status=!1,m.eventTarget.socialRegisterLogin.container.removeClass("active")}),$(m.eventTarget.socialRegisterLogin.buttonLogin).on("click",function(a){a.stopImmediatePropagation();return m.eventTarget.socialRegisterLogin.status?!1:(m.eventTarget.socialRegisterLogin.status=!0,void fbAppHelper.authorize(function(){fbAppHelper.getUser(function(a){for(key in a)fbAppHelper.data.user[key]=a[key];a.access_token=fbAppHelper.authResponse.accessToken,url=m.urls.website+m.urls.userSocialRegisterLogin;var b=function(a){o.personal=a.data,i.prototype.start(),m.eventTarget.socialRegisterLogin.status=!0},d=function(b){b.exist||(m.eventTarget.socialRegisterLogin.form.find("input[name='email']").val(a.email),m.eventTarget.socialRegisterLogin.form.find("input[name='username']").val(a.name),m.eventTarget.socialRegisterLogin.form.append('<input type="hidden" name="fbname" value="'+a.name+'" />'),a.email&&m.eventTarget.socialRegisterLogin.form.append('<input type="hidden" name="fbemail" value="'+a.email+'" />'),m.eventTarget.socialRegisterLogin.form.append('<input type="hidden" name="fbid" value="'+a.id+'" />'),a.gender&&m.eventTarget.socialRegisterLogin.form.append('<input type="hidden" name="gender" value="'+a.gender+'" />'),m.eventTarget.login.container.removeClass("active"),m.eventTarget.register.container.removeClass("active"),m.eventTarget.socialRegisterLogin.container.addClass("active")),m.eventTarget.socialRegisterLogin.status=!1};c(url,a,b,d)})},function(){m.eventTarget.socialRegisterLogin.status=!1},"email"))}),d(function(a,b,d){$(m.eventTarget.socialRegisterLogin.buttonSubmit).on("click",function(e){if(e.stopImmediatePropagation(),m.eventTarget.socialRegisterLogin.authenticate)return!1;if(m.eventTarget.socialRegisterLogin.authenticate=!0,a=[],!m.eventTarget.socialRegisterLogin.form.isValid(d,b,!0))return m.eventTarget.socialRegisterLogin.authenticate=!1,!1;url=m.urls.website+m.urls.userRegister,data=m.eventTarget.socialRegisterLogin.form.serialize();var f=function(a){o.personal=a.data,m.eventTarget.socialRegisterLogin.container.removeClass("popIn").removeClass("fadeIn"),i.prototype.start(),m.eventTarget.socialRegisterLogin.authenticate=!0},g=function(a){a.exist||alert(a.message),m.eventTarget.socialRegisterLogin.authenticate=!1};c(url,data,f,g)})}),a},i.prototype.userRegister=function(){var a=this;return d(function(a,b,d){$(m.eventTarget.register.close).on("click",function(a){m.eventTarget.register.status=!1,m.eventTarget.register.container.removeClass("active")}),$(m.eventTarget.register.open).on("click",function(a){m.eventTarget.register.status=!1,m.eventTarget.register.container.addClass("active")}),$(m.eventTarget.register.buttonSubmit).on("click",function(e){if(e.stopImmediatePropagation(),m.eventTarget.register.status)return!1;if(m.eventTarget.register.status=!0,a=[],!m.eventTarget.register.form.isValid(d,b,!0))return m.eventTarget.register.status=!1,!1;url=m.urls.website+m.urls.userRegister,email=m.eventTarget.register.form.find("input[name='email']").val(),username=m.eventTarget.register.form.find("input[name='username']").val(),paragon=m.eventTarget.register.form.find("input[name='paragon']").val(),data={email:email,username:username,paragon:paragon};var f=function(a){o.personal=a.data,i.prototype.start(),m.eventTarget.register.status=!0},g=function(a){return a.exist?(m.eventTarget.register.container.removeClass("active"),m.eventTarget.login.container.addClass("active"),m.eventTarget.register.status=!1,void m.eventTarget.login.form.find("input[name='email']").val(email)):(m.eventTarget.register.container.removeClass("active"),m.eventTarget.login.container.addClass("active"),void(m.eventTarget.register.status=!1))};c(url,data,f,g)})}),a},i.prototype.userLogin=function(){var a=this;return d(function(a,b,d){$(m.eventTarget.login.close).on("click",function(a){m.eventTarget.login.status=!1,m.eventTarget.login.container.removeClass("active")}),$(m.eventTarget.login.open).on("click",function(a){m.eventTarget.login.status=!1,m.eventTarget.login.container.addClass("active")}),$(m.eventTarget.login.buttonSubmit).on("click",function(e){if(e.stopImmediatePropagation(),m.eventTarget.login.status)return!1;if(m.eventTarget.login.status=!0,a=[],!m.eventTarget.login.form.isValid(d,b,!0))return m.eventTarget.login.status=!1,!1;url=m.urls.website+m.urls.userLogin,email=m.eventTarget.login.form.find("input[name='email']").val(),data={email:email};var f=function(a){o.personal=a.data,i.prototype.start(),m.eventTarget.login.status=!0},g=function(a){return a.exist?void 0:(m.eventTarget.register.form.find("input[name='email']").val(email),m.eventTarget.login.container.removeClass("active"),m.eventTarget.register.container.addClass("active"),void(m.eventTarget.login.status=!1))};c(url,data,f,g)})}),a},i.prototype.userRestart=function(a){function b(a){return a.split(/[?#]/)[0]}function c(){var a;"undefined"!=typeof o.personal.email?o.personal.email.length>0&&(a=o.personal.email):"undefined"!=typeof o.personal.secondaryEmail&&o.personal.secondaryEmail.length>0&&(a=o.personal.secondaryEmail);var c=b($("body").data("url"))+"?email="+a;a&&c?window.location=c:window.location=window.location.href}var d=this;return a?c():$(m.eventTarget.gameRestart).on("click",function(){c()}),d},i.prototype.userLogout=function(){function a(a){return a.split(/[?#]/)[0]}function b(){var b=a($("body").data("url"));window.location=b}var c=this;return $(m.eventTarget.gameLogout).on("click",function(){b()}),c},i.prototype.start=function(a){var b=this;return m.eventTarget.register.container.removeClass("active"),m.eventTarget.splash.container.removeClass("active"),m.eventTarget.socialRegisterLogin.container.removeClass("active"),m.eventTarget.login.container.removeClass("active"),m.eventTarget.overlay.container.addClass("nobg").addClass("active"),$(".notify-arrow").addClass("active"),$(m.eventTarget.login.open).removeClass("active"),$(".scoreboard-link").removeClass("active"),$(".account-link").addClass("active"),$(".scoreboard-link-black").addClass("active"),$(".notes").removeClass("active"),n.action.started?this:(n.action.started=!0,b.eventOnTouch().eventOnMouseWheel(),setInterval(function(){n.action.waitingForScrollToStart&&(n.action.waitingForScrollToStart=!1,m.eventTarget.overlay.container.addClass("fadeOut").removeClass("active"),b.gameStarted())},m.gameSettings.fpms),b)},i.prototype.updatePeak=function(){var a=this;return n.eventTimer.peak[1]=setInterval(function(){n.storage.peakField=n.storage.peak>=m.gameSettings.peak?m.gameSettings.peak:n.storage.peak>=1e3?n.storage.peak.toFixed(0):n.storage.peak>=100?n.storage.peak.toFixed(1):n.storage.peak.toFixed(2),n.eventTarget.fieldPeak.text(n.storage.peakField)},b(n.eventTimer.peak[0])),a},i.prototype.updateSpeed=function(){var a=this;return n.eventTimer.speedAverage[1]=setInterval(function(){n.storage.speedField=Math.abs(n.storage.speed)>m.gameSettings.speed.maximum?m.gameSettings.speed.maximum:Math.abs(n.storage.speed.toFixed(0)),k?n.eventTarget.fieldAvgSpeed.text(2*n.storage.speedField+"cm/s"):n.eventTarget.fieldAvgSpeed.text(n.storage.speedField+"cm/s")},b(n.eventTimer.speedAverage[0])),a},i.prototype.updateTimer=function(){var a=this;return n.eventTimer.timeSpent[1]=setInterval(function(){return n.storage.finishGame||n.storage.giveUpGame?!1:(n.storage.timeField=g(),void n.eventTarget.fieldTimeSpent.text(n.storage.timeField))},b(n.eventTimer.timeSpent[0])),a},i.prototype.updateScreen=function(){var a=this;return n.eventTarget.screen.css({top:n.storage.height,left:n.storage.screen.left}),n.storage.centerMain||(n.eventTarget.screen.stop().animate({marginTop:-(m.gameTexture.firstImage.height-n.storage.screen.height),left:n.storage.screen.left,paddingLeft:n.storage.screen.paddingLeft}),n.storage.centerMain=!0),a},i.prototype.updateFrame=function(){function a(){b.watchSpeed(),b.updateScreen(),setTimeout(a,m.gameSettings.fpms)}var b=this;a();var c=!0;setInterval(function(){n.storage.peak=(n.storage.height+n.storage.screen.height)/m.gameSettings.ppm,n.storage.peak>=m.gameSettings.pearkMaxToEnableSave&&c&&(c=!1,n.eventTarget.fieldSaveGame.on("click",function(){b.userRestart(!0),$(m.eventTarget.gameRestart).trigger("click")}),n.eventTarget.fieldSaveGame.addClass("active"),n.eventTarget.sidebar.addClass("active"))},m.gameSettings.fpms);var d=setInterval(function(){n.storage.lastScene?clearInterval(d):b.updateTexture()},m.gameSettings.textureRedrawms);return b},i.prototype.updateGame=function(){var a=this;n.eventTimer.timeSpent[1]=setInterval(function(){if(n.storage.time>=m.gameSettings.maximumTime){if(n.storage.finishGame)return!1;n.storage.finishGame=!0,a.updatePlay()}},b(n.eventTimer.timeSpent[0]))},i.prototype.gameStarted=function(){return this.updatePeak().updateSpeed().updateTimer().updateFrame().updateQRCode().updateGame(),this},i.prototype.template=function(a,b,c){return"<img id='"+a+"' src='"+b+"' style='"+c+"'/>"},i.prototype.updateTexture=function(){var a=this,b=n.storage.height+n.storage.screen.height;return a.layoutAutoTexture(b).layoutQuanlity(b),a},i.prototype.updateQRCode=function(){var a=this;return n.eventTimer.qrCodeChecker[1]=setInterval(function(){if(n.storage.finishGame){if("0"!==o.personal.qrcode||o.update.qr!==!1)return!1;o.update.qr=!0,o.personal.qrcode=1,url=m.urls.website+m.urls.userQRCode,data={id:o.personal.id};var a=function(a){$(".qrcode").find("img").attr("src",a.qr_url)},b=function(a){alert(a.message)};c(url,data,a,b)}},b(n.eventTimer.qrCodeChecker[0])),a},i.prototype.createPlay=function(a){function b(){if(!o.game_id){url=m.urls.website+m.urls.roomCreate,data={id:o.personal.id};var a=function(a){o.game_id=a.game_id,o.unique_id=a.unique_id},b=function(a){alert(a.message)};c(url,data,a,b)}}var d=this;return b(),d},i.prototype.updatePlay=function(){function a(){if(o.game_id){url=m.urls.website+m.urls.roomUpdate,data={id:o.personal.id,game_id:o.game_id,unique_id:o.unique_id,distance:n.storage.peakField,timespent:n.storage.time};var a=function(a){b.finishGame()},d=function(a){alert(a.message)};c(url,data,a,d)}}var b=this;if(n.storage.giveUpGame=!0,o.game_id)a();else{b.createPlay();var d=setTimeout(function(){o.game_id&&(a(),clearInterval(d))},1e3)}return b},i.prototype.finishGame=function(){var a=this;return $(m.eventTarget.scrollCoverArea).unbind("touchmove"),o.update.qr?$(m.eventTarget.qr.container).addClass("active"):$(m.eventTarget.finish.container).addClass("active"),$(m.eventTarget.score.button).trigger("click"),a},i.prototype.openScene=function(a){$(document).ready(function(){$("*").imagesLoaded({}).always(function(){m.eventTarget.loading.container.removeClass("active"),a===!0&&(m.eventTarget.overlay.container.addClass("active"),m.eventTarget.splash.container.addClass("active"))}).progress(function(a,b){if(!n.action.started){b.isLoaded?"loaded":"broken";m.loading.totalLoadedImage++,m.eventTarget.loading.fieldFeedback.text((m.loading.totalLoadedImage/a.images.length*100).toFixed(0)+" %")}})})},i.prototype.init=function(){function a(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}function b(a){if(a){m.eventTarget.login.status=!0,url=m.urls.website+m.urls.userLogin,data={email:a};var b=function(a){o.personal=a.data,i.prototype.start(),m.eventTarget.login.container.removeClass("active"),m.eventTarget.register.container.removeClass("active"),m.eventTarget.login.status=!0,d.openScene(!1)},e=function(b){return b.exist?void 0:(m.eventTarget.register.form.find("input[name='email']").val(a),m.eventTarget.login.container.removeClass("active"),m.eventTarget.register.container.addClass("active"),m.eventTarget.login.status=!1,void d.openScene(!0))};c(url,data,b,e)}else d.openScene(!0)}var d=this;$.validate({errorMessagePosition:"top"}),this.layoutCreateInterface().layoutWindowResize().layoutCreateTexture(),$(window).on("debouncedresize",function(a){n.action.started&&0!==n.storage.height||d.updateScreen()}),$(window).trigger("debouncedresize"),this.userLogin().userRegister().userSocialRegisterLogin().userScoreBoard().userRestart().userAccount().userLogout();var e=a("email");return b(e),this};i()}());
